# ä¸­å›½è‚¡ç¥¨æ•°æ®æ”¶é›†ç³»ç»Ÿ (MVC æ¶æ„ç‰ˆ)

è¿™æ˜¯ä¸€ä¸ªé‡‡ç”¨ MVC æ¶æ„è®¾è®¡çš„ä¸­å›½é‡‘èå¸‚åœºæ•°æ®æ”¶é›†å’Œå­˜å‚¨åº”ç”¨ç¨‹åºã€‚

## ğŸ—ï¸ æ¶æ„ç‰¹æ€§

- ğŸ¯ **MVC æ¶æ„**: æ¸…æ™°çš„æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨åˆ†ç¦»
- ğŸ”§ **æ¨¡å—åŒ–è®¾è®¡**: é«˜å†…èšã€ä½è€¦åˆçš„ä»£ç ç»“æ„
- ğŸ”„ **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œæ•°æ®æº
- ğŸ® **å¤šè¿è¡Œæ¨¡å¼**: æ”¯æŒè‡ªåŠ¨æ¨¡å¼å’Œäº¤äº’æ¨¡å¼
- ğŸ“Š **ä¸°å¯Œçš„ç”¨æˆ·ç•Œé¢**: ç¾è§‚çš„æ§åˆ¶å°è¾“å‡ºå’Œè¿›åº¦æ˜¾ç¤º

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ index.py                   # æ—§ç‰ˆæœ¬ï¼ˆä¿ç•™å…¼å®¹ï¼‰
â”œâ”€â”€ config/                    # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ database_config.py     # æ•°æ®åº“é…ç½®ç®¡ç†
â”œâ”€â”€ models/                    # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ stock_data_model.py    # è‚¡ç¥¨æ•°æ®æ¨¡å‹
â”œâ”€â”€ views/                     # è§†å›¾å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ console_view.py        # æ§åˆ¶å°è§†å›¾
â”œâ”€â”€ controllers/               # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ stock_controller.py    # è‚¡ç¥¨æ•°æ®æ§åˆ¶å™¨
â”œâ”€â”€ utils/                     # å·¥å…·ç±»
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ logger_util.py         # æ—¥å¿—å·¥å…·
â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ .env.example              # é…ç½®æ¨¡æ¿
â””â”€â”€ requirements.txt          # ä¾èµ–åŒ…åˆ—è¡¨
```

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- ğŸ”„ è‡ªåŠ¨è·å–æœŸè´§æ”¶ç›Šç‡æ•°æ®ï¼ˆæ”¯æŒèºçº¹é’¢ç­‰å“ç§ï¼‰
- ğŸ—„ï¸ æ•°æ®è‡ªåŠ¨å­˜å‚¨åˆ° MySQL æ•°æ®åº“
- ğŸ§¹ å†…ç½®æ•°æ®æ¸…æ´—å’Œå»é‡åŠŸèƒ½
- ğŸ“Š å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†
- âš¡ ä¼˜åŒ–çš„æ•°æ®åº“è¿æ¥æ± å’Œæ‰¹é‡æ’å…¥
- ğŸ”’ äº‹åŠ¡å®‰å…¨ä¿è¯æ•°æ®ä¸€è‡´æ€§
- ğŸ® äº¤äº’å¼ç”¨æˆ·ç•Œé¢
- ğŸ“ˆ æ•°æ®é¢„è§ˆå’Œç»Ÿè®¡ä¿¡æ¯

## ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

- Python 3.12.10+
- MySQL 5.7+ æˆ– 8.0+

## ğŸ“¦ å®‰è£…æ­¥éª¤

### 1. å®‰è£…ä¾èµ–åŒ…

```bash
# ä½¿ç”¨pipå®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt
```

### 2. æ•°æ®åº“é…ç½®

1. ç¡®ä¿ MySQL æœåŠ¡æ­£åœ¨è¿è¡Œ
2. åˆ›å»ºæ•°æ®åº“ï¼š

```sql
CREATE DATABASE stock CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3. ç¯å¢ƒå˜é‡é…ç½®

1. å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼š

```bash
copy .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„æ•°æ®åº“ä¿¡æ¯ï¼š

```env
DB_USER=root
DB_PASSWORD=your_actual_password
DB_HOST=localhost
DB_PORT=3306
DB_NAME=stock
TABLE_NAME=roll_yield_bar
LOG_LEVEL=INFO
```

## ğŸ® è¿è¡Œç¨‹åº

### è‡ªåŠ¨æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨é»˜è®¤å‚æ•°è¿è¡Œ
python main.py

# æŒ‡å®šå‚æ•°è¿è¡Œ
python main.py --var RB --start-day 20180618 --end-day 20180718
```

### äº¤äº’æ¨¡å¼

```bash
# å¯åŠ¨äº¤äº’æ¨¡å¼
python main.py --interactive
```

### å…¼å®¹æ¨¡å¼

```bash
# è¿è¡Œæ—§ç‰ˆæœ¬
python index.py
```

## ğŸ“‹ å‘½ä»¤è¡Œå‚æ•°

| å‚æ•°            | ç®€å†™ | è¯´æ˜                | é»˜è®¤å€¼   |
| --------------- | ---- | ------------------- | -------- |
| `--interactive` | `-i` | å¯ç”¨äº¤äº’æ¨¡å¼        | False    |
| `--var`         |      | å“ç§ä»£ç             | RB       |
| `--start-day`   |      | å¼€å§‹æ—¥æœŸ (YYYYMMDD) | 20180618 |
| `--end-day`     |      | ç»“æŸæ—¥æœŸ (YYYYMMDD) | 20180718 |
| `--log-level`   |      | æ—¥å¿—çº§åˆ«            | INFO     |

## ğŸ¨ MVC æ¶æ„è¯´æ˜

### ğŸ“Š Model (æ¨¡å‹å±‚)

- `models/stock_data_model.py`: è´Ÿè´£æ•°æ®è·å–ã€æ¸…æ´—å’Œå­˜å‚¨
- å¤„ç†ä¸ akshare API çš„äº¤äº’
- ç®¡ç†æ•°æ®åº“æ“ä½œå’Œäº‹åŠ¡

### ğŸ‘ï¸ View (è§†å›¾å±‚)

- `views/console_view.py`: è´Ÿè´£ç”¨æˆ·ç•Œé¢æ˜¾ç¤º
- æä¾›ç¾è§‚çš„æ§åˆ¶å°è¾“å‡º
- å¤„ç†ç”¨æˆ·è¾“å…¥å’Œäº¤äº’

### ğŸ® Controller (æ§åˆ¶å™¨å±‚)

- `controllers/stock_controller.py`: åè°ƒæ¨¡å‹å’Œè§†å›¾
- å¤„ç†ä¸šåŠ¡é€»è¾‘æµç¨‹
- ç®¡ç†ç³»ç»ŸçŠ¶æ€å’Œé”™è¯¯å¤„ç†

### âš™ï¸ Config (é…ç½®å±‚)

- `config/database_config.py`: æ•°æ®åº“é…ç½®ç®¡ç†
- ç¯å¢ƒå˜é‡å¤„ç†
- è¿æ¥å‚æ•°ä¼˜åŒ–

### ğŸ”§ Utils (å·¥å…·å±‚)

- `utils/logger_util.py`: æ—¥å¿—ç³»ç»Ÿç®¡ç†
- æä¾›é€šç”¨å·¥å…·å‡½æ•°

## ğŸ“Š ç¨‹åºè¾“å‡ºç¤ºä¾‹

```
============================================================
ğŸš€ ä¸­å›½è‚¡ç¥¨æ•°æ®æ”¶é›†ç³»ç»Ÿ
============================================================
âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
â³ [1/4] è·å–è‚¡ç¥¨æ•°æ®
âœ… æˆåŠŸè·å– 100 æ¡åŸå§‹æ•°æ®
â³ [2/4] æ¸…æ´—æ•°æ®
âœ… æ•°æ®æ¸…æ´—å®Œæˆï¼Œå‰©ä½™ 98 æ¡æœ‰æ•ˆæ•°æ®
â³ [3/4] ç”Ÿæˆæ•°æ®é¢„è§ˆ

ğŸ“Š æ•°æ®é¢„è§ˆ:
----------------------------------------
æ•°æ®å½¢çŠ¶: (98, 5)
æ•°æ®åˆ—: ['date', 'open', 'high', 'low', 'close']
å†…å­˜ä½¿ç”¨: 3.85 KB

â³ [4/4] ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“
âœ… æ•°æ®ä¿å­˜æˆåŠŸ

ğŸ“ˆ æ•°æ®æ±‡æ€»:
----------------------------------------
è¡¨å: roll_yield_bar
æ€»è®°å½•æ•°: 98

============================================================
ğŸ‰ ç¨‹åºæ‰§è¡ŒæˆåŠŸå®Œæˆï¼
============================================================
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**

   - æ£€æŸ¥ MySQL æœåŠ¡æ˜¯å¦å¯åŠ¨
   - éªŒè¯ `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®
   - ç¡®è®¤æ•°æ®åº“åç§°å­˜åœ¨

2. **æ¨¡å—å¯¼å…¥é”™è¯¯**

   - ç¡®ä¿æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…
   - æ£€æŸ¥ Python è·¯å¾„é…ç½®

3. **æƒé™é”™è¯¯**
   - ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰åˆ›å»ºè¡¨çš„æƒé™
   - æ£€æŸ¥æ–‡ä»¶å†™å…¥æƒé™ï¼ˆæ—¥å¿—æ–‡ä»¶ï¼‰

### æ—¥å¿—æ–‡ä»¶

æŸ¥çœ‹ `stock_data.log` æ–‡ä»¶è·å–è¯¦ç»†çš„æ‰§è¡Œä¿¡æ¯å’Œé”™è¯¯è¯¦æƒ…ã€‚

## ğŸš€ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æ•°æ®æº

1. åœ¨ `models/` ä¸­åˆ›å»ºæ–°çš„æ•°æ®æ¨¡å‹
2. åœ¨ `controllers/` ä¸­æ·»åŠ å¯¹åº”çš„æ§åˆ¶å™¨
3. æ›´æ–°è§†å›¾ä»¥æ”¯æŒæ–°çš„æ•°æ®æ˜¾ç¤º

### æ·»åŠ æ–°çš„è¾“å‡ºæ ¼å¼

1. åœ¨ `views/` ä¸­åˆ›å»ºæ–°çš„è§†å›¾ç±»
2. åœ¨æ§åˆ¶å™¨ä¸­é›†æˆæ–°è§†å›¾
3. æ›´æ–°ä¸»ç¨‹åºä»¥æ”¯æŒæ–°çš„è¾“å‡ºé€‰é¡¹

### æ•°æ®åº“æ‰©å±•

1. ä¿®æ”¹ `config/database_config.py` æ·»åŠ æ–°çš„é…ç½®
2. åœ¨æ¨¡å‹ä¸­æ·»åŠ æ–°çš„æ•°æ®åº“æ“ä½œæ–¹æ³•
3. æ›´æ–°ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **æ•°æ®åº“è¿æ¥æ± **: å¤ç”¨è¿æ¥ï¼Œå‡å°‘å¼€é”€
- **æ‰¹é‡æ“ä½œ**: å¤§æ•°æ®é›†åˆ†æ‰¹å¤„ç†
- **äº‹åŠ¡ç®¡ç†**: ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **å†…å­˜ä¼˜åŒ–**: åŠæ—¶é‡Šæ”¾èµ„æº
- **å¼‚æ­¥å¤„ç†**: æ”¯æŒå¹¶å‘æ“ä½œï¼ˆå¯æ‰©å±•ï¼‰

## ğŸ¯ å®Œæ•´çš„ AKShare æ•°æ®åŒæ­¥ç³»ç»Ÿ

### ç³»ç»Ÿç»„ä»¶

#### 1. æ•°æ®åŒæ­¥æ¨¡å—

- **akshare_sync_main.py**: æ‰‹åŠ¨æ•°æ®åŒæ­¥
- **scheduler_main.py**: è‡ªåŠ¨å®šæ—¶åŒæ­¥
- **models/akshare_sync_model.py**: æ•°æ®åŒæ­¥æ ¸å¿ƒé€»è¾‘

#### 2. æ•°æ®ç®¡ç†æ¨¡å—

- **data_manager_main.py**: æ•°æ®ç®¡ç†å·¥å…·
- **utils/data_manager.py**: æ•°æ®ç®¡ç†æ ¸å¿ƒåŠŸèƒ½

#### 3. ç³»ç»Ÿç›‘æ§æ¨¡å—

- **system_monitor.py**: å®æ—¶ç³»ç»Ÿç›‘æ§é¢æ¿
- **utils/scheduler.py**: è°ƒåº¦å™¨ç®¡ç†

#### 4. ç»Ÿä¸€å¯åŠ¨å™¨

- **start.py**: ç³»ç»Ÿå¯åŠ¨å™¨ï¼Œæä¾›ç»Ÿä¸€å…¥å£

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### æ–¹æ³• 1: ä½¿ç”¨å¯åŠ¨å™¨ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨ç³»ç»Ÿå¯åŠ¨å™¨
python start.py

# æˆ–ç›´æ¥å¯åŠ¨ç‰¹å®šæ¨¡å¼
python start.py --mode sync      # æ•°æ®åŒæ­¥
python start.py --mode scheduler # è‡ªåŠ¨è°ƒåº¦
python start.py --mode manager   # æ•°æ®ç®¡ç†
python start.py --mode monitor   # ç³»ç»Ÿç›‘æ§
```

#### æ–¹æ³• 2: ç›´æ¥è¿è¡Œ

```bash
# æ‰‹åŠ¨æ•°æ®åŒæ­¥
python akshare_sync_main.py --interactive
python akshare_sync_main.py --category stock
python akshare_sync_main.py --all

# å¯åŠ¨è‡ªåŠ¨è°ƒåº¦å™¨
python scheduler_main.py

# æ•°æ®ç®¡ç†
python data_manager_main.py --list-tables
python data_manager_main.py --table-info stock_stock_info
python data_manager_main.py --sample stock_stock_info

# ç³»ç»Ÿç›‘æ§
python system_monitor.py
```

### ğŸ“Š æ•°æ®åŒæ­¥åŠŸèƒ½

#### æ”¯æŒçš„æ•°æ®ç±»å‹

- **è‚¡ç¥¨æ•°æ®**: åŸºæœ¬ä¿¡æ¯ã€å†å²æ•°æ®ã€è´¢åŠ¡æ•°æ®ã€ä¸ªè‚¡ä¿¡æ¯
- **æœŸè´§æ•°æ®**: ä¸»åŠ›åˆçº¦ã€ç°è´§æ•°æ®ã€æ”¶ç›Šç‡æ•°æ®
- **åŸºé‡‘æ•°æ®**: ETF åˆ†ç±»ã€å¼€æ”¾å¼åŸºé‡‘ä¿¡æ¯
- **å€ºåˆ¸æ•°æ®**: ä¸­ç¾å›½å€ºæ”¶ç›Šç‡ã€ä¸­å›½å›½å€ºæ”¶ç›Šç‡
- **å¤–æ±‡æ•°æ®**: ä¸­è¡Œå¤–æ±‡ç‰Œä»·ã€å®æ—¶æ±‡ç‡
- **å®è§‚æ•°æ®**: GDPã€CPIã€PPIã€PMI ç­‰ç»æµæŒ‡æ ‡
- **æ–°é—»æ•°æ®**: è‚¡ç¥¨æ–°é—»ã€å¤®è§†æ–°é—»
- **è¡Œä¸šæ•°æ®**: è¡Œä¸šæ¿å—ã€æ¦‚å¿µæ¿å—

#### è‡ªåŠ¨è°ƒåº¦åŠŸèƒ½

- è‚¡ç¥¨æ•°æ®: æ¯ 5 åˆ†é’ŸåŒæ­¥
- æœŸè´§æ•°æ®: æ¯ 3 åˆ†é’ŸåŒæ­¥
- åŸºé‡‘æ•°æ®: æ¯ 10 åˆ†é’ŸåŒæ­¥
- å€ºåˆ¸æ•°æ®: æ¯ 30 åˆ†é’ŸåŒæ­¥
- å¤–æ±‡æ•°æ®: æ¯ 1 åˆ†é’ŸåŒæ­¥
- å®è§‚æ•°æ®: æ¯ 1 å°æ—¶åŒæ­¥
- æ–°é—»æ•°æ®: æ¯ 15 åˆ†é’ŸåŒæ­¥
- è¡Œä¸šæ•°æ®: æ¯ 30 åˆ†é’ŸåŒæ­¥

### ğŸ› ï¸ æ•°æ®ç®¡ç†åŠŸèƒ½

#### è¡¨ç®¡ç†

```bash
# åˆ—å‡ºæ‰€æœ‰è¡¨
python data_manager_main.py --list-tables

# æŸ¥çœ‹è¡¨è¯¦ç»†ä¿¡æ¯
python data_manager_main.py --table-info stock_stock_info

# æŸ¥çœ‹æ•°æ®æ ·æœ¬
python data_manager_main.py --sample stock_stock_info

# å¯¼å‡ºè¡¨æ•°æ®
python data_manager_main.py --export stock_stock_info --output stock_info.csv
```

#### äº¤äº’å¼ç®¡ç†

```bash
python data_manager_main.py
```

### ğŸ“ˆ ç³»ç»Ÿç›‘æ§

å®æ—¶ç›‘æ§é¢æ¿æ˜¾ç¤ºï¼š

- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- æ•°æ®åº“è¿æ¥çŠ¶æ€å’Œå¤§å°
- å„è¡¨çš„è®°å½•æ•°ç»Ÿè®¡
- è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯ 5 ç§’ï¼‰

```bash
python system_monitor.py
```

### âš™ï¸ é…ç½®è¯´æ˜

#### ç¯å¢ƒå˜é‡é…ç½® (.env)

```env
# æ•°æ®åº“é…ç½®
DB_USER=root
DB_PASSWORD=your_password
DB_HOST=localhost
DB_PORT=3306
DB_NAME=stock
TABLE_NAME=roll_yield_bar

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=stock_data.log

# æ•°æ®åº“è¿æ¥æ± é…ç½®
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
```

### ğŸ“‹ æ•°æ®è¡¨ç»“æ„

åŒæ­¥åçš„æ•°æ®è¡¨å‘½åè§„åˆ™ï¼š`{category}_{data_name}`

ä¾‹å¦‚ï¼š

- `stock_stock_info`: è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
- `stock_stock_zh_a_hist`: A è‚¡å†å²æ•°æ®
- `futures_futures_main_sina`: æœŸè´§ä¸»åŠ›åˆçº¦
- `macro_macro_china_gdp`: ä¸­å›½ GDP æ•°æ®

### ğŸ”§ é«˜çº§åŠŸèƒ½

#### 1. æ‰¹é‡æ•°æ®åŒæ­¥

```bash
# åŒæ­¥æ‰€æœ‰æ•°æ®
python akshare_sync_main.py --all

# åŒæ­¥ç‰¹å®šåˆ†ç±»
python akshare_sync_main.py --category stock
```

#### 2. å®šæ—¶ä»»åŠ¡ç®¡ç†

```bash
# å¯åŠ¨è°ƒåº¦å™¨ï¼ˆåå°è¿è¡Œï¼‰
nohup python scheduler_main.py > scheduler.log 2>&1 &

# åœæ­¢è°ƒåº¦å™¨
pkill -f scheduler_main.py
```

#### 3. æ•°æ®å¯¼å‡ºå’Œå¤‡ä»½

```bash
# å¯¼å‡ºæ‰€æœ‰è¡¨æ•°æ®
for table in $(python -c "from utils.data_manager import DataManager; from config.database_config import DatabaseConfig; dm = DataManager(DatabaseConfig()); print(' '.join(dm.get_table_list()))"); do
    python data_manager_main.py --export $table --output "backup_${table}.csv"
done
```

### ğŸš¨ æ³¨æ„äº‹é¡¹

1. **API é™åˆ¶**: akshare æœ‰è®¿é—®é¢‘ç‡é™åˆ¶ï¼Œç³»ç»Ÿå·²å†…ç½®å»¶æ—¶æœºåˆ¶
2. **æ•°æ®é‡**: æŸäº›å†å²æ•°æ®é‡è¾ƒå¤§ï¼Œé¦–æ¬¡åŒæ­¥å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
3. **ç½‘ç»œç¨³å®šæ€§**: å»ºè®®åœ¨ç½‘ç»œç¨³å®šçš„ç¯å¢ƒä¸‹è¿è¡Œ
4. **æ•°æ®åº“æƒé™**: ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰åˆ›å»ºè¡¨å’Œå†™å…¥æ•°æ®çš„æƒé™
5. **ç£ç›˜ç©ºé—´**: é¢„ç•™è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å­˜å‚¨æ•°æ®

### ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. æ—¥å¿—æ–‡ä»¶ `stock_data.log`
2. æ•°æ®åº“è¿æ¥é…ç½®
3. ç½‘ç»œè¿æ¥çŠ¶æ€
4. akshare åº“ç‰ˆæœ¬å…¼å®¹æ€§

ç°åœ¨æ‚¨æ‹¥æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„ã€ä¸“ä¸šçš„ AKShare æ•°æ®åŒæ­¥ç³»ç»Ÿï¼
